<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Notas</title>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js"></script>
    <style>
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="login-form">
    <input type="text" id="matricula" placeholder="Digite sua matrícula">
    <button onclick="login()">Entrar</button>
    <div id="login-error" class="hidden">Matrícula inválida.</div>
</div>

<div id="notas-form" class="hidden">
    <h2 id="aluno-nome"></h2>
    <select id="disciplina" onchange="carregarNota()">
        <option value="">Selecione uma disciplina</option>
        <option value="ADMINISTRAÇÃO DE PESSOAL">Administração de Pessoal</option>
        <option value="ADMINISTRAÇÃO LOGÍSTICA FINANCEIRA">Administração Logística Financeira</option>
        <option value="ARMAMENTO, MUNIÇÃO E TIRO POLICIAL">Armamento, Munição e Tiro Policial</option>
        <option value="ATENDIMENTO PRÉ-HOSPITALAR TÁTICO">Atendimento Pré-Hospitalar Tático</option>
        <option value="COMANDO CHEFIA E LIDERANÇA">Comando Chefia e Liderança</option>
        <option value="DEFESA PESSOAL POLICIAL">Defesa Pessoal Policial</option>
        <option value="DIREITO ADMINISTRATIVO DISCIPLINAR">Direito Administrativo Disciplinar</option>
        <option value="DIREITO PENAL MILITAR, PROCESSUAL PENAL MILITAR">Direito Penal Militar</option>
        <option value="EDUCAÇÃO FÍSICA POLICIAL MILITAR">Educação Física Policial Militar</option>
        <option value="ÉTICA E DIREITOS HUMANOS NA ATIVIDADE POLICIAL">Ética e Direitos Humanos</option>
        <option value="GERENCIAMENTO DE ATIVIDADE OPERACIONAL">Gerenciamento de Atividade Operacional</option>
        <option value="INTELIGÊNCIA POLICIAL">Inteligência Policial</option>
        <option value="LEGISLAÇÃO DE TRÂNSITO E OPERAÇÕES">Legislação de Trânsito</option>
        <option value="LEGISLAÇÃO INSTITUCIONAL">Legislação Institucional</option>
        <option value="ORDEM UNIDA">Ordem Unida</option>
        <option value="POLÍCIA DE PROXIMIDADE">Polícia de Proximidade</option>
        <option value="POLÍCIA OSTENSIVA">Polícia Ostensiva</option>
        <option value="SISTEMA DE COMANDO E OPERAÇÕES E AJUDA HUMANITÁRIA">Sistema de Comando e Operações</option>
        <option value="TÉCNICA DE SOBREVIVÊNCIA POLICIAL">Técnica de Sobrevivência Policial</option>
        <option value="TÉCNICAS E OPERAÇÕES DE POLÍCIA MILITAR">Técnicas e Operações de Polícia Militar</option>
        <option value="TÓPICOS ESPECIAIS DE LEGISLAÇÃO APLICÁVEIS À ATIVIDADE POLICIAL">Tópicos Especiais</option>
    </select>
    
    <input type="number" id="nota" placeholder="Digite a nota (1 a 10)" min="1" max="10">
    <label>
        <input type="checkbox" id="rank" onclick="toggleRankingButton()"> Incluir no ranking
    </label>
    <button onclick="salvarNota()">Salvar Nota</button>
    <button id="ranking-btn" class="hidden" onclick="verNotas()">Ver Ranking</button>
    <button onclick="calcularMedia()">Calcular Média</button>
    <div id="nota-success" class="hidden">Nota salva com sucesso!</div>
    <div id="nota-error" class="hidden">Erro ao salvar a nota. Verifique se está no intervalo correto.</div>
    <div id="todas-notas" class="hidden"></div>
</div>

<script>
// Importando funções do SDK Firebase
import { initializeApp } from "firebase/app";
import { getDatabase, ref, set, get, child } from "firebase/database";

// Configurações do Firebase
const firebaseConfig = {
    apiKey: "AIzaSyDEvCDdX0LGjDMFpyxljj-4JTjZKtgooDM",
    authDomain: "notas-cfs.firebaseapp.com",
    projectId: "notas-cfs",
    storageBucket: "notas-cfs.appspot.com",
    messagingSenderId: "91086463856",
    appId: "1:91086463856:web:6a16fb0b3abe04bbc425b5"
};

// Inicializando o Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Mapeamento de matrículas para nomes
const alunos = {"9287027": "ELIENAR FARIAS",
          "9306820": "NAZARETH LIMA GOEDERT",
        "9303219": "CARLA DE LUCA LINHARES",
        "9287124": "LEANDRO GHELLERE",
        "9287124": "LEANDRO GHELLERE",
        "9300350": "TIAGO LUIZ CLEMES",
        "9288350": "MARCOS AURÉLIO LUIZ DUARTE",
        "9320547": "ANDRÉ LUIS PATRÍCIO",
        "9288520": "MATHEUS ROSSI LONGO",
        "9320555": "RICARDO MESQUITA DE MEDEIROS",
        "9320601": "JOSÉ RENATO COSTA",
        "9307800": "JEAN CARLOS PEREIRA MACHADO",
        "9300600": "AILTON BOZELLO DE BITTENCOURT",
        "9300341": "TIAGO SANTOS DE SOUZA",
        "9316230": "RODRIGO SILVA DOS SANTOS",
        "9308652": "ANDERSON ROVEDA",
        "9333967": "MAYARA ZILI DA SILVA",
        "9316221": "MARCOS ADRIANO DAL PONT",
        "9333860": "SARAH WAGNER ZANATTA",
        "9329730": "FELIPE LUMERTZ DA SILVA",
        "9316116": "JAQUES ROCHA DE SOUZA",
        "9329340": "ÉZIO FRANCISCO FERNANDES",
        "9329382": "EDERSON FRANÇA DE MACHADO",
        "6606032": "ROBSON GOMES HAHN",
        "9339558": "EVANDRO ANASTÁCIO TEIXEIRA",
        "9339329": "TIAGO ANSELMO VALNIER",
        "9287205": "ALEXANDRE DA LUZ",
        "9307745": "WANDERSON RICARDO DE CARVALHO",
        "9316159": "ANDERSON DOS SANTOS ROSA",
        "9320563": "IURI CÚRCIO CARRER",
        "6718680": "LAURO TOGNON NETO",
        "9330097": "PATRICK CARDOSO DE RAMOS",
        "9330356": "BRUNA DA SILVA PIRES",
        "3847446": "DAIANA PEREIRA",
        "9329056": "VINICIUS JOVELINO COSTA",
        "9339477": "DANIEL SERAFIM PESSI"
};

let matriculaAtual;

function login() {
    const matricula = document.getElementById('matricula').value;
    if (alunos[matricula]) {
        matriculaAtual = matricula;
        document.getElementById('aluno-nome').innerText = `Bem-vindo, ${alunos[matricula]}`;
        document.getElementById('login-form').classList.add('hidden');
        document.getElementById('notas-form').classList.remove('hidden');
    } else {
        document.getElementById('login-error').classList.remove('hidden');
    }
}

function salvarNota() {
    const disciplina = document.getElementById('disciplina').value;
    const nota = parseFloat(document.getElementById('nota').value);
    const rank = document.getElementById('rank').checked;

    if (nota >= 1 && nota <= 10) {
        set(ref(db, `notas/${matriculaAtual}/${disciplina}`), {
            nota: nota,
            rank: rank
        });
        document.getElementById('nota-success').classList.remove('hidden');
        document.getElementById('nota-error').classList.add('hidden');
        document.getElementById('ranking-btn').disabled = false;
        document.getElementById('ranking-btn').style.display = 'block';
        document.getElementById('nota').value = '';
    } else {
        document.getElementById('nota-error').classList.remove('hidden');
    }
}

function carregarNota() {
    const disciplina = document.getElementById('disciplina').value;

    if (disciplina) {
        const notaRef = ref(db, `notas/${matriculaAtual}/${disciplina}`);
        get(notaRef).then((snapshot) => {
            if (snapshot.exists()) {
                const notaData = snapshot.val();
                document.getElementById('nota').value = notaData.nota;
                document.getElementById('rank').checked = notaData.rank;
            } else {
                document.getElementById('nota').value = '';
                document.getElementById('rank').checked = false;
            }
        }).catch((error) => {
            console.error("Erro ao carregar a nota:", error);
        });
    } else {
        document.getElementById('nota').value = '';
        document.getElementById('rank').checked = false;
    }
}

function verNotas() {
    const notasRef = ref(db, `notas/${matriculaAtual}`);
    get(notasRef).then((snapshot) => {
        if (snapshot.exists()) {
            let notasHTML = '<h3>Notas Salvas:</h3><ul>';
            snapshot.forEach(childSnapshot => {
                const disciplina = childSnapshot.key;
                const nota = childSnapshot.val();
                notasHTML += `<li>${disciplina}: ${nota.nota} - ${nota.rank ? 'Incluir no ranking' : 'Não incluir no ranking'}</li>`;
            });
            notasHTML += '</ul>';
            document.getElementById('todas-notas').innerHTML = notasHTML;
            document.getElementById('todas-notas').classList.remove('hidden');
        }
    }).catch((error) => {
        console.error("Erro ao buscar as notas:", error);
    });
}

function calcularMedia() {
    const notasRef = ref(db, `notas/${matriculaAtual}`);
    get(notasRef).then((snapshot) => {
        if (snapshot.exists()) {
            let total = 0;
            let count = 0;
            snapshot.forEach(childSnapshot => {
                total += childSnapshot.val().nota;
                count++;
            });
            const media = total / count;
            alert(`A média das notas é: ${media.toFixed(2)}`);
        }
    }).catch((error) => {
        console.error("Erro ao calcular a média:", error);
    });
}

function toggleRankingButton() {
    const rank = document.getElementById('rank').checked;
    const rankingBtn = document.getElementById('ranking-btn');
    rankingBtn.style.display = rank ? 'block' : 'none';
}

</script>

</body>
</html>
